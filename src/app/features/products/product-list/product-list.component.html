<div class="container-fluid py-4">
  <div class="row">
    <!-- Filters Sidebar -->
    <div class="col-md-3 mb-4">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Filters</h5>

          <!-- Search -->
          <div class="mb-3">
            <label class="form-label">Search</label>
            <div class="input-group">
              <input
                type="text"
                class="form-control"
                [value]="searchQuery()"
                (input)="searchQuery.set(getInputValue($event))"
                (keyup.enter)="onSearch()"
                placeholder="Search products..."
              />
              <button class="btn btn-outline-secondary" (click)="onSearch()">
                <i class="bi bi-search"></i>
              </button>
            </div>
          </div>

          <!-- Categories -->
          <div class="mb-3">
            <label class="form-label">Categories</label>
            <div class="list-group list-group-flush">
              <button
                class="list-group-item list-group-item-action"
                [class.active]="!selectedCategory()"
                (click)="onCategorySelect(null)"
              >
                All Products
              </button>
              @for (category of categories(); track category.id) {
                <button
                  class="list-group-item list-group-item-action"
                  [class.active]="selectedCategory() === category.name"
                  (click)="onCategorySelect(category.name)"
                >
                  {{ category.name }}
                </button>
              }
            </div>
          </div>

          <!-- Sort -->
          <div class="mb-3">
            <label class="form-label">Sort By</label>
            <div class="btn-group w-100" role="group">
              <button
                type="button"
                class="btn btn-outline-primary"
                [class.active]="sortBy() === 'price'"
                (click)="onSort('price')"
              >
                Price
              </button>
              <button
                type="button"
                class="btn btn-outline-primary"
                [class.active]="sortBy() === 'name'"
                (click)="onSort('name')"
              >
                Name
              </button>
            </div>
            @if (sortBy()) {
              <small class="text-muted">{{ direction() === 'asc' ? '↑' : '↓' }}</small>
            }
          </div>
        </div>
      </div>
    </div>

    <!-- Products -->
    <div class="col-md-9">
      @if (error()) {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
          {{ error() }}
          <button type="button" class="btn-close" (click)="error.set(null)"></button>
        </div>
      }

      @if (isLoading()) {
        <div class="text-center">
          <div class="spinner-border" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>
      } @else {
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
          @for (product of products(); track product.id) {
            <div class="col">
              <div class="card h-100 product-card">
                <img
                  [src]="getImageUrl(product.imageURL)"
                  class="card-img-top"
                  alt="{{ product.name }}"
                  loading="lazy"
                />
                <div class="card-body">
                  <h6 class="card-title">{{ product.name }}</h6>
                  <p class="card-text text-muted text-truncate">{{ product.description }}</p>
                  <p class="text-sm text-secondary">{{ product.category.name }}</p>
                </div>
                <div class="card-footer bg-white border-top">
                  <div class="d-flex justify-content-between align-items-center">
                    <span class="h5 mb-0 text-primary">{{ product.price }} DZD</span>
                    @if (product.stock > 0) {
                      <button
                        class="btn btn-sm btn-primary"
                        (click)="addToCart(product)"
                      >
                        <i class="bi bi-cart-plus"></i> Add
                      </button>
                    } @else {
                      <span class="badge bg-danger">Out of Stock</span>
                    }
                  </div>
                  <small class="text-muted">Stock: {{ product.stock }}</small>
                </div>
              </div>
            </div>
          }
        </div>

        <!-- Pagination -->
        @if (totalPages() > 1) {
          <nav aria-label="Page navigation" class="mt-4">
            <ul class="pagination justify-content-center">
              <li class="page-item" [class.disabled]="currentPage() === 0">
                <button
                  class="page-link"
                  (click)="onPageChange(currentPage() - 1)"
                  [disabled]="currentPage() === 0"
                >
                  Previous
                </button>
              </li>

              @for (page of [].constructor(totalPages()); let i = $index; track i) {
                <li class="page-item" [class.active]="currentPage() === i">
                  <button
                    class="page-link"
                    (click)="onPageChange(i)"
                  >
                    {{ i + 1 }}
                  </button>
                </li>
              }

              <li class="page-item" [class.disabled]="currentPage() === totalPages() - 1">
                <button
                  class="page-link"
                  (click)="onPageChange(currentPage() + 1)"
                  [disabled]="currentPage() === totalPages() - 1"
                >
                  Next
                </button>
              </li>
            </ul>
          </nav>
        }
      }
    </div>
  </div>
</div>
